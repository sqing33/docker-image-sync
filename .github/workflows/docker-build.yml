      - name: 9. 更新 README.md 中的“已构建的 Docker 镜像”表格
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git pull --rebase

          # 准备表格新条目所需的信息
          GHCR_IMAGE_NAME="ghcr.io/${{ github.repository_owner }}/${{ github.event.inputs.image_name }}"
          DOCKERHUB_IMAGE_NAME="${{ secrets.DOCKERHUB_USERNAME }}/${{ github.event.inputs.image_name }}"
          SOURCE_REPO_PATH=$(echo "${{ github.event.inputs.repo_url }}" | sed -E 's|https?://github.com/||; s/\.git$//')
          SOURCE_REPO_URL="[${SOURCE_REPO_PATH}](${{ github.event.inputs.repo_url }})"

          # 从 README 中提取 START 和 END 标记之间的现有表格内容
          EXISTING_CONTENT=$(awk '/<!-- BUILD_TABLE_START -->/{flag=1; next} /<!-- BUILD_TABLE_END -->/{flag=0} flag' README.md)

          # 检查镜像是否已存在于表格中 (基于ghcr.io的镜像名)
          if echo "$EXISTING_CONTENT" | grep -q "$GHCR_IMAGE_NAME"; then
            echo "镜像 $GHCR_IMAGE_NAME 的记录已存在于 README.md，跳过更新。"
            exit 0
          fi

          echo "添加新构建的镜像记录到 README.md"

          # 从现有内容中提取数据行，并计算新行号
          data_lines=$(echo "$EXISTING_CONTENT" | grep -E '^\| [0-9]+')
          count=$(echo "$data_lines" | wc -l | xargs)
          new_count=$((count + 1))

          # 格式化新行
          printf -v new_row "| %-3s | %s | \`%s\` | \`%s\` | \`%s\` |" \
            "$new_count" \
            "$SOURCE_REPO_URL" \
            "$GHCR_IMAGE_NAME" \
            "$DOCKERHUB_IMAGE_NAME" \
            "${{ github.event.inputs.platforms }}"

NEW_TABLE_CONTENT=$(cat <<EOF
|   | 源仓库 | pull 镜像 (ghcr.io) | pull 镜像 (Docker Hub) | 构建平台 |
|---|---|---|---|---|
$(echo "$data_lines")
$new_row
EOF
)

          # 使用 awk 将 START 和 END 标记之间的旧内容替换为新的完整表格
          awk -v new_content="$NEW_TABLE_CONTENT" '
            BEGIN {p=1}
            /<!-- BUILD_TABLE_START -->/ {
              print;
              print new_content;
              p=0;
            }
            /<!-- BUILD_TABLE_END -->/ {p=1}
            p {print}
          ' README.md > README.tmp && mv README.tmp README.md

          # 提交并推送更改
          git add README.md
          if git diff --staged --quiet; then
            echo "README.md 没有变化，无需提交。"
          else
            git commit -m "docs: 新增构建镜像 ${{ github.event.inputs.image_name }} 的记录"
            git push
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
